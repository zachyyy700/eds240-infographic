---
author: "Zach Loo"
execute:
    message: false
    warning: false
---

# III. Pre-Planning

1. My main goal for this infographic is to inform those who know nothing about horseracing, specifically in Japan. Recently, I've been thinking about what to include to accomplish this goal. Recently, I've been thinking about focusing in on a particular race, the Arima Kinen (AK). This is one of the most popular races that occurs in December every year and it's special since horse racing fans get to vote in which horses they want to run. Instead of summarizing all the race data in this dataset, focusing on this specific race could be more impactful. So my overarching question would be something like: How do horses at this top level of racing compare to other horses not at this level? To address this main question first I'll answer who have been the winners of the Arima Kinen? For subquestions to answer the comparison, I have two main metrics to compare: finish times & prize money. 

2. I'm interesting in creating a general summary table for the AK, who have been the winners (`horse_name`), were they expected to win or did an underdog take home the win (`popular_rank`). There's also metrics also like `prize_money_10kY`, `horse_age`, and `margin` which is the measurement of difference in horse lengths of the horse in front of it at the finish (in this case I mainly look at the margin for 2nd place to see how close 1st & 2nd place are).

3. Infographic inspiration

Inspiration #1

![](inspo/tour-de-france.png)

Since this is a large table of the Tour de France winners and their respective stats, I thought I could definitely use this for my race too, as a large summary table of the Arima Kinen winners.

Inspiration #2

![](inspo/rap-artists-likert.png)

I liked this one because it has levels of favorites (1st favorite, 2nd favorite etc.), horse racing also has this as races have favorites to win the race, determined by the fans.

# IV. Hand-drawn Viz

![](inspo/drawn_viz.JPG)

```{r}
library(tidyverse)
library(scales)
library(ggtext)
library(ggpubr)
library(showtext)

font_add_google("Playfair", "playfair")
font_add_google("Courier Prime", "courier")
```

```{r}
# Load clean data
jra_results <- read_csv(here::here('data', 'jra_clean.csv'), 
col_types = cols(race_id_horsenum = 'c', race_id = 'c', finish_time = 'c')) |> 
    
    # Convert time character to duration
    mutate(finish_time = as.duration(ms(finish_time)))
```

# Color Palette

```{r}
colors <- c(
    "deepred" = "#A4252A", 
    "red" = "#E74A22", 
    "orange" = "#F4BA1F", 
    "yellow" = "#F8F360", 
    "blue" = "#4392CE", 
    "green" = "#52b788", 
    "tan" = "#F3F2EE")

# monochromeR::view_palette(colors)
```

# Recent AK Data

This dataset only goes up to 2021 and even the 2021 data isn't complete (up to 07-18-2021). Since I'm shifting my focus to just one race, the Arima Kinen, recent AK data can be manually compiled from the JRA official website. The following sections consist of:

1. Creating a new dataframe containing recent AK information 2021-2025

2. Joining on the original dataframe with `bind_rows()`

-  optional: translate Japanese labels for plotting

3. Resulting analysis.

# Arima Kinen Margins

```{r}
# Filter original df to AK margins for margins plot
ak_margins <- jra_results |> 
    filter(race_name == "有馬記念", final_position == 2) |> 
    select(race_date, horse_name, year, margin_horselen, margin_parsed)
```

```{r}
# Compile recent margin data of interest, margins of horses that placed 2nd
ak_margins_recent <- tibble(
    race_date = c("2021-12-26", "2022-12-25", "2023-12-24", "2024-12-22", "2025-12-28"),
    horse_name = c("ディープボンド", "ボルドグフーシュ", "スターズオンアース", "シャフリヤール", "コスモキュランダ"),
    year = c(2021, 2022, 2023, 2024, 2025),
    margin_horselen = c("3/4", "2.1/2", "1/2", "ハナ", "1/2"),
    margin_parsed = c(0.75, 2.5, 0.5, 0.05, 0.5)
) |> 
    mutate(race_date = as.Date(race_date))

ak_margins_all <- bind_rows(ak_margins, ak_margins_recent) |> 
    mutate(n = row_number())
```

```{r fig.width = 9, fig.height = 6}
# ak_margins_all |> 
#     group_by(margin_parsed) |> 
#     summarise(count = n()) |> 
#     ggplot(aes(margin_parsed, count)) +

#     scale_x_continuous(breaks = c(0.05, 0.2, 0.25, 0.5, 0.75, seq(1, 10, by = 1))) +

#     theme_classic() +
#     geom_point()
showtext_auto(enable = TRUE)
subtitle <- "At this high-level of racing, races are *close*."

ggplot(ak_margins_all, aes(x = margin_parsed)) +
    geom_histogram(fill = colors[['deepred']], binwidth = 0.1) +
    labs(x = "Winning Margin (horse lengths)", y = "Number of Races", title = "Arima Kinen Winning Margins", subtitle = subtitle) +
    theme_light(base_family = 'playfair', base_size = 15) +
    theme(
        plot.title = element_text(size = 28),
        plot.subtitle = element_markdown(size = 20),
        plot.background = element_rect(fill = colors[['tan']], color = NA),
        axis.text = element_text(family = 'courier'),

    )
```

# Arima Kinen Winners

```{r}
# Filter original df to Arima Kinen & select columns of interest
ak_winners <- jra_results |> 
    filter(race_name == "有馬記念", final_position == 1) |> 
    select(race_id, race_date, year, distance_m, horse_num, horse_name, horse_age, finish_time, final_600m_time, win_odds_100Y, win_fav, prize_money_10kY, horse_trainer, horse_owner) 
```

```{r}
# Compile recent AK winners of interest
ak_winners_recent <- tibble(
    race_date = c("2021-12-26", "2022-12-25", "2023-12-24", "2024-12-22", "2025-12-28"),
    distance_m = c(2500),
    horse_num = c(10, 9, 5, 8, 4),
    horse_name = c("エフフォーリア", "イクイノックス", "ドウデュース", "レガレイラ", "ミュージアムマイル"),
    horse_age = c(3, 3, 4, 3, 3),
    finish_time = c("2:32.0", "2:32.4", "2:30.9", "2:31.8", "2:31.5"),
    final_600m_time = c(35.9, 35.4, 34.3, 34.9, 34.6),
    win_odds_100Y = c(2.1, 2.3, 5.2, 10.9, 3.8),
    win_fav = c(1, 1, 2, 5, 3),
    prize_money_10kY = c(30336.0, 40336.0, 50340.2, 50340.2, 50352.8), 
    year = c(2021, 2022, 2023, 2024, 2025),
    horse_trainer = c("鹿戸雄一", "木村哲也", "友道康夫", "木村哲也", "高柳大輔"),
    horse_owner = c("キャロットファーム", "シルクレーシング", "キーファーズ", "サンデーレーシング", "サンデーレーシング")
) |> 
    mutate(
        race_date = as.Date(race_date),
        finish_time = as.duration(ms(finish_time)))
```

```{r}
# Add new rows to outdated data
arima_kinen_all  <- bind_rows(ak_winners, ak_winners_recent) |> 
    mutate(
        n = row_number(), 
        annot = ifelse(n %% 5 == 0 & n != n(), TRUE, FALSE),
        avg_speed_m_s = distance_m / as.numeric(finish_time)) |> 

    mutate(win_fav_rev = abs(win_fav - 16), .after = win_fav)
```

This plot also needs an English horse name column so create a translate df to join on the data.

```{r}
# Create translation df
ak_names <- tibble(
  horse_name = c(
    "ダイナガリバー", "メジロデュレン", "オグリキャップ", "イナリワン", "ダイユウサク",
    "メジロパーマー", "トウカイテイオー", "ナリタブライアン", "マヤノトップガン", "サクラローレル",
    "シルクジャスティス", "グラスワンダー", "テイエムオペラオー", "マンハッタンカフェ", "シンボリクリスエス",
    "ゼンノロブロイ", "ハーツクライ", "ディープインパクト", "マツリダゴッホ", "ダイワスカーレット",
    "ドリームジャーニー", "ヴィクトワールピサ", "オルフェーヴル", "ゴールドシップ", "ジェンティルドンナ",
    "ゴールドアクター", "サトノダイヤモンド", "キタサンブラック", "ブラストワンピース", "リスグラシュー",
    "クロノジェネシス", "エフフォーリア", "イクイノックス", "ドウデュース", "レガレイラ",
    "ミュージアムマイル"
  ),
  horse_name_eng = c(
    "Dyna Gulliver", "Mejiro Durren", "Oguri Cap", "Inari One", "Daiyu Saku",
    "Mejiro Palmer", "Tokai Teio", "Narita Brian", "Mayano Top Gun", "Sakura Laurel",
    "Silk Justice", "Grass Wonder", "T M Opera O", "Manhattan Cafe", "Symboli Kris S",
    "Zenno Rob Roy", "Hearts Cry", "Deep Impact", "Matsurida Gogh", "Daiwa Scarlet",
    "Dream Journey", "Victoire Pisa", "Orfevre", "Gold Ship", "Gentildonna",
    "Gold Actor", "Satono Diamond", "Kitasan Black", "Blast Onepiece", "Lys Gracieux",
    "Chrono Genesis", "Efforia", "Equinox", "Do Deuce", "Regaleira",
    "Museum Mile"
  )
)

# Join on arima kinen df
arima_kinen_all <- left_join(arima_kinen_all, ak_names, by = 'horse_name') |> 
    relocate(horse_name_eng, .after = horse_name)
```

```{r}
# Create prize money label column
arima_kinen_all <- arima_kinen_all |> 
    mutate(prize_money_label = round(prize_money_10kY / 100, 1), .after = prize_money_10kY)

# Create repeat winners columns
arima_kinen_all <- arima_kinen_all |> 
    group_by(horse_name_eng) |> 
    mutate(win_count = n()) |> 
    mutate(repeat_win_label = ifelse(win_count > 1, paste0("**", horse_name_eng, "**"), horse_name_eng))
```

```{r fig.height=10, fig.width=9}
showtext_auto(enable = TRUE)
showtext_opts(dpi = 96)

ggplot(arima_kinen_all) + 

    # Dotted gridlines
    geom_segment(aes(x = 0, xend = 20000, y = n, yend = n), linetype = 'dotted', linewidth = 0.2) +
    
    # Year list
    geom_text(aes(x = -1000, y = n, label = year), family = 'courier', size = 4) +

    # Winners list
    geom_richtext(aes(x = 3000, y = n, label = repeat_win_label), fill = colors[['tan']], label.size = 0, label.padding = unit(0.1, "lines"), family = 'playfair', size = 5) +

    # Margin plot
    geom_segment(data = ak_margins_all, aes(x = 8000 - margin_parsed * 150, xend = 8000 + margin_parsed * 150, y = n, yend = n), linewidth = 3) +

    # Popular rank plot
    geom_segment(aes(x = 10000, xend = 10000 + win_fav_rev * 250, y = n, yend = n), linewidth = 2, color = colors[['orange']], alpha = 0.6) +

    # Prize money plot
    geom_ribbon(aes(xmin = 14000, xmax = 14000 + prize_money_10kY * 0.115, y = n), orientation = 'y', position = 'identity', fill = colors[['red']], alpha = 0.6) +
    geom_point(data = subset(arima_kinen_all, annot), aes(x = 14000 + prize_money_10kY * 0.115, y = n), size = 1) +
    geom_richtext(data = subset(arima_kinen_all, annot), aes(x = 14000 + prize_money_10kY * 0.115 + 400, y = n, label = prize_money_label), fill = colors[['tan']], hjust = 0, label.size = 0, label.padding = unit(0.1, "lines"), family = 'courier', size = 3) +
    
    # Column titles
    annotate("text", x = c(-1000, 3000, 8000, 12000, 17000), y = -2, label = c("Year", "Winner", "Winning\nMargin Size", "Favorite-to-Win", "Prize Money"), size = 4.5, family = 'playfair', lineheight = 0.7) +
    # Vertical lines
    annotate("segment", x = c(-2000, 0, 6000, 10000, 14000, 20000), xend = c(-2000, 0, 6000, 10000, 14000, 20000), y = -3, yend = 41, linewidth = 0.3) +
    # Horizontal lines
    annotate("segment", x = -2000, xend = 20000, y = c(-3, -1, 41), yend = c(-3, -1, 41), linewidth = 0.3) +

    # Column unit labels
    annotate("text", x = c(10500, 13500), y = 0, label = c("Least", "Most"), hjust = c(0, 1), size = 3) +
    annotate("text", x = c(14500, 19500), y = 0, label = c("0", "¥500M"), hjust = c(0, 1), size = 3) +


    labs(title = "Arima Kinen Winners", caption = "Repeat Winners") +

    scale_y_reverse(expand = expansion(mult = 0.0001)) +

    theme_void() +

    theme(
        plot.background = element_rect(fill = "#F3F2EE", color = NA),
        plot.margin = margin(10, 10, 10, 10),
        plot.title = element_text(family = 'playfair', size = 32, margin = margin(0, 0, 5, 10)),
        plot.caption = element_text(face = 'bold', family = 'playfair')
    )
```

```{r}
# showtext_opts(dpi = 320)
# # Save Arima Kinen Winners
# ggsave(here::here("outputs", paste0("ak_winners_", format(Sys.time(), "%Y%m%d_%H%M%S"), ".png")), dpi = 320, width = 9, height = 10)
```

# Arima Kinen Age Distribution

```{r}
# Create age df for all JRA races
jra_age <- jra_results |> 
    mutate(horse_age = ifelse(horse_age >= 10, "10+", as.character(horse_age))) |> 
    group_by(horse_age) |> 
    summarise(age_count = n()) |> 
    ungroup() |> 
    mutate(age_perc = age_count / sum(age_count)) |> 
    mutate(horse_age = factor(horse_age, levels = c("2", "3", "4", "5", "6", "7", "8", "9", "10+")))

# Create age df for just AK
ak_age <- arima_kinen_all |> 
    group_by(horse_age) |> 
    summarise(age_count = n()) |> 
    ungroup() |> 
    mutate(age_perc = age_count / sum(age_count)) |> 
    mutate(horse_age = factor(horse_age))
```

```{r}
# Combine age dfs
age_combined <- jra_age |> 
    select(horse_age, jra_perc = age_perc) |> 
    full_join(ak_age |> select(horse_age, ak_perc = age_perc), by = 'horse_age') |> 
    replace_na(list(ak_perc = 0)) 
    # pivot_longer(cols = c(jra_perc, ak_perc), names_to = 'type', names_pattern = "(.*)_perc", values_to = 'percent')
```

```{r fig.width=9, fig.height=6}
ggplot(data = age_combined) +
    geom_segment(aes(x = horse_age, xend = horse_age, y = jra_perc, yend = ak_perc), color = 'grey69') +
    geom_point(aes(x = horse_age, y = jra_perc, color = "Other Races"), size = 3) +
    geom_point(aes(x = horse_age, y = ak_perc, color = "Arima Kinen"), size = 3) +

    labs(x = "Horse Age", y = "Percentage", title = "Age Comparisons between Arima Kinen & Other Races", subtitle = "") +

    scale_color_manual(values = c("Other Races" = 'grey59', "Arima Kinen" = colors[['deepred']])) +
    scale_y_continuous(labels = label_percent()) +

    theme_classic(base_family = 'courier', base_size = 15) +
    theme(
        plot.background = element_rect(fill = colors[['tan']], color = NA),
        plot.title = element_text(family = 'playfair', size = 23),
        panel.background = element_rect(fill = colors[['tan']], color = NA),
        panel.grid.major.y = element_line(color = 'grey59', linewidth = 0.5, linetype = 'dotted'),
        legend.title = element_blank(),
        legend.background = element_rect(fill = colors[['tan']], color = NA),
        legend.position = 'top'
        )
```

# Arima Kinen Finish Times
How do finish times at the Arima Kinen compare to other races (same track & distance)?

```{r}
non_ak_winners <- jra_results |> 
    filter(race_name != "有馬記念", distance_m == 2500, racetrack_name == '中山', final_position == 1, track_surface == "芝") |> 
    group_by(race_name) |> 
    mutate(race_count = n()) |> 
    filter(race_count >= 25)

non_ak_yearly <- non_ak_winners |> 
    group_by(year) |> 
    summarise(avg_win_time = mean(finish_time))
```

```{r fig.height=6, fig.width=9}
ggplot() +
    geom_line(data = non_ak_yearly, aes(year, avg_win_time, color = 'Other Races')) +
    geom_point(data = non_ak_yearly, aes(year, avg_win_time), color = 'grey59', size = 2) +

    geom_line(data = arima_kinen_all, aes(year, finish_time, color = 'Arima Kinen')) +
    geom_point(data = arima_kinen_all, aes(year, finish_time), color = colors[['deepred']], size = 2) +

    scale_color_manual(values = c("Other Races" = 'grey59', "Arima Kinen" = colors[['deepred']])) +

    annotate('richtext', x = 1997, y = 149.5, label = 'Current Record Holder:<br><b>Zenno Rob Roy (2:29.5)', label.size = 0, family = 'courier', fill = colors[['tan']]) +

    labs(x = "Year", y = "Finish Time (seconds)", title = "Arima Kinen Win Times: Faster Than the Rest", subtitle = "AK winners finish faster than other race winners on the same track & distance.") +
    
    scale_x_continuous(breaks = seq(1985, 2025, by = 5), labels = seq(1985, 2025, by = 5)) +

    theme_classic(base_family = 'courier', base_size = 14) +

    theme(
        panel.grid.major.y = element_line(color = 'grey59', linewidth = 0.5, linetype = 'dotted'),
        panel.background = element_rect(fill = "#F3F2EE", color = NA),
        plot.background = element_rect(fill = "#F3F2EE", color = NA),
        plot.title = element_markdown(family = 'playfair', size = 28),
        plot.title.position = 'plot',
        plot.subtitle = element_text(size = 12),
        legend.title = element_blank(),
        legend.position = 'top',
        legend.background = element_rect(fill = colors[['tan']], color = NA)
    )

```

# Arima Kinen Prize Money Comparison
Since the Arima Kinen is one of the biggest races, how does 1st place prize money compare with other G1 races?

```{r}
# Create df for recent data, winners of different G1 races & 1st place prize
prize_g1_recent <- tribble(
    ~year, ~race_name, ~prize_money_10kY,
    2021, "東京優駿", 22718.8,
    2021, "有馬記念", 30336,
    2021, "宝塚記念", 15281.4,

    2022, "東京優駿", 22697.8,
    2022, "有馬記念", 40336,
    2022, "宝塚記念", 20378,

    2023, "東京優駿", 32734.9,
    2023, "有馬記念", 50340.2,
    2023, "宝塚記念", 22369.6,

    2024, "東京優駿", 32886.8,
    2024, "有馬記念", 50340.2,
    2024, "宝塚記念", 22273,

    2025, "東京優駿", 32771.3,
    2025, "有馬記念", 50352.8,
    2025, "宝塚記念", 30361.2,
)
```

```{r}
prize_g1 <- jra_results |> 
    filter(race_grade == "G1", race_name %in% c("有馬記念", "宝塚記念", "東京優駿", "安田記念"), final_position == 1, year != 2021) |> 
    select(year, race_name, prize_money_10kY)
```

```{r}
# Combine recent & original data
prize_g1_all <- bind_rows(prize_g1, prize_g1_recent)
```

```{r}
race_names_translate <- tibble(
    race_name = c("有馬記念", "宝塚記念", "東京優駿", "安田記念"),
    race_name_eng = c("Arima Kinen", "Takarazuka Kinen", "Tokyo Yushun", "Yasuda Kinen")
)

prize_g1_all <- left_join(prize_g1_all, race_names_translate, by = 'race_name') 
```

```{r}
prize_g1_all <- prize_g1_all |> 
    mutate(race_name_eng = factor(race_name_eng, levels = c("Arima Kinen", "Tokyo Yushun", "Takarazuka Kinen", "Yasuda Kinen")))
```

```{r fig.height=6, fig.width=9}
ggplot(prize_g1_all) +
    geom_line(aes(x = year, y = prize_money_10kY, group = race_name_eng, color = race_name_eng), linewidth = 1.5) +

    labs(x = "Year", y = "Prize Money", title = "Arima Kinen Winning Prize", subtitle = "Compared to other G1 races, the AK holds the largest prize pool.") +

    scale_y_continuous(labels = label_currency(prefix = "¥", suffix = "M", scale = 1/100)) +

    scale_color_manual(values = c(colors[['deepred']], colors[['green']], colors[['blue']], colors[['orange']])) +

    scale_x_continuous(breaks = seq(1990, 2025, by = 5)) +

    theme_classic(base_family = 'courier', base_size = 13) + 
    theme(
        panel.grid.major.y = element_line(color = 'grey59', linewidth = 0.5, linetype = 'dotted'),
        panel.background = element_rect(fill = colors[['tan']], color = NA),
        plot.background = element_rect(fill = colors[['tan']], color = NA),
        plot.title = element_text(family = 'playfair', size = 28),
        plot.title.position = 'plot',
        legend.title = element_blank(),
        legend.background = element_rect(fill = colors[['tan']], color = NA),
        legend.position = 'top')
```

# Arima Kinen Favorite Win Rate

```{r}
ak_fav_winrates <- arima_kinen_all |> 
    mutate(win_fav_bin = case_when(
        win_fav %in% c(1, 2, 3) ~ "1-3",
        win_fav %in% c(4, 5, 6) ~ "4-6",
        win_fav %in% c(7, 8, 9) ~ "7-9",
        win_fav >= 10 ~ "10+"
    ), .after = win_fav) |> 

    mutate(win_fav_bin = factor(win_fav_bin, levels = c("1-3", "4-6", "7-9", "10+")))
```

```{r}
ak_fav_winrates |> 
    group_by(win_fav_bin) |> 
    summarise(win_rate = n() / nrow(ak_fav_winrates)) |> 
    ggdonutchart(x = 'win_rate', label = 'win_fav_bin', lab.pos = 'in',
    color = 'white',
    fill = 'win_fav_bin',
    palette = c(colors[['orange']], colors[['yellow']], colors[['blue']], colors[['green']])) +

    labs(title = "Arima Kinen Winrates by Favorite Rank") +

    theme(legend.position = 'none')
```

# VI. Progress

1. Key insights

Since shifting my focus to just one prestigious race, I mainly want to compare the differences between this high level of horse racing and 'lower' levels. In horse racing, there are G1, G2, and G3 races used to classify the quality of races. G1 being the top with the best horses and high prize pool and G3 still considered prestigious but lowest level of the graded races. The key insight I want to convey is about the high performance level difference between the graded levels, specifically, the Arima Kinen since it's a 'top-of-the-top' race. For this I'm planning to analyze certain metrics of this high level race and plot the same metric for other races to see how they compare.

2. Challenges

One challenge with this data is that the dataset only goes up to 2021 (and even 2021 isn't complete). Since I shifted to comparing one high-level race, I thought it wouldn't be so bad to compile the data from the official JRA website and while it wasn't too bad, it was still kind of a lengthy process. Another challenge I encountered since shifting focus, there wasn't a lot of options of plots. I just couldn't come up with ideas that would answer my overall question and be appropriate for an audience that knows nothing about horse racing. One last thing was there's no really "so what?" for this infographic. Since I'm simply just displaying information about the Arima Kinen and comparing against other races, there's no really main takeaway from the plots so I think a lot of context will have to come from supplemental text as well.

3. Extra packages

One package needed is the ggtext package as I want to bold names in my winners list that are repeat winners. This will allow me to create a label column that will be passed to `element_markdown()` so that repeat winners can be bolded in the final plot.

4. Feedback

The main thing I want feedback is what could be explained more? Since my audience is mostly people who don't know much about horse racing, what gaps still exist after seeing these plots/the final infographic. After working on this dataset for a while and learning about the world of horse racing, I feel that I have more knowledge and context in my mind but unsure if it's being translated correctly into my plots, and to someone who knows nothing about this world, some things could still remain unclear.